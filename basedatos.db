
USE dltcat;

-- Tabla de usuarios
CREATE TABLE `user` (
  id INT AUTO_INCREMENT PRIMARY KEY,
  mail VARCHAR(255) NOT NULL UNIQUE,
  name VARCHAR(255) NOT NULL,
  password VARCHAR(255) NOT NULL,
  role VARCHAR(50),
  language VARCHAR(50),
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deletedAt DATETIME NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla de verificación
CREATE TABLE verification (
  id INT AUTO_INCREMENT PRIMARY KEY,
  targetEmail VARCHAR(255) NOT NULL,
  verificationToken VARCHAR(255) NOT NULL,
  name VARCHAR(255),
  password VARCHAR(255),
  language VARCHAR(50),
  acceptedAt DATE NULL,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deletedAt DATETIME NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla de gatos
CREATE TABLE cat (
  id INT AUTO_INCREMENT PRIMARY KEY,
  externalId TEXT,
  url TEXT,
  width INT,
  height INT,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deletedAt DATETIME NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla de razas
CREATE TABLE breed (
  id INT AUTO_INCREMENT PRIMARY KEY,
  externalId VARCHAR(255),
  name TEXT NOT NULL,
  temperament TEXT,
  origin TEXT,
  description TEXT,
  wikiUrl TEXT,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deletedAt DATETIME NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Relación muchos-a-muchos entre cat y breed
CREATE TABLE cat_breeds (
  catId   INT NOT NULL,
  breedId INT NOT NULL,
  PRIMARY KEY (catId, breedId),
  CONSTRAINT fk_cat_breeds_cat
    FOREIGN KEY (catId) REFERENCES cat(id) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_cat_breeds_breed
    FOREIGN KEY (breedId) REFERENCES breed(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabla de mascotas (relación con user y cat)
CREATE TABLE pet (
  id INT AUTO_INCREMENT PRIMARY KEY,
  petName TEXT NOT NULL,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deletedAt DATETIME NULL,
  ownerId  INT,
  animalId INT,
  CONSTRAINT fk_pet_owner
    FOREIGN KEY (ownerId) REFERENCES `user`(id) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_pet_animal
    FOREIGN KEY (animalId) REFERENCES cat(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
